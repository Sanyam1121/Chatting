<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern Firebase Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script type="module">
    // Firebase Config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const provider = new GoogleAuthProvider();
    const signInBtn = document.getElementById("signInBtn");
    const chatContainer = document.getElementById("chatContainer");
    const chatList = document.getElementById("chatList");
    const messageForm = document.getElementById("messageForm");
    const messageInput = document.getElementById("messageInput");

    signInBtn.addEventListener("click", async () => {
      await signInWithPopup(auth, provider);
    });

    onAuthStateChanged(auth, user => {
      if (user) {
        signInBtn.classList.add("hidden");
        chatContainer.classList.remove("hidden");
        const messagesRef = collection(db, "messages");
        const q = query(messagesRef, orderBy("timestamp"));

        onSnapshot(q, snapshot => {
          chatList.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const msgDiv = document.createElement("div");
            msgDiv.className = "bg-gray-800 p-2 rounded-xl mb-2";
            msgDiv.innerHTML = `<strong>${data.name}</strong>: ${data.text}`;
            chatList.appendChild(msgDiv);
          });
        });

        messageForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          if (messageInput.value.trim() === "") return;
          await addDoc(messagesRef, {
            name: user.displayName,
            text: messageInput.value,
            timestamp: serverTimestamp()
          });
          messageInput.value = "";
        });
      }
    });
  </script>
</head>
<body class="bg-gray-900 text-white h-screen flex overflow-hidden">

  <!-- Sidebar -->
  <aside class="w-16 bg-gray-800 flex flex-col items-center py-4 space-y-6">
    <button id="signInBtn" class="text-white bg-blue-600 px-2 py-1 rounded">Sign In</button>
  </aside>

  <!-- Chat Layout -->
  <div id="chatContainer" class="hidden flex-1 flex flex-col">
    <!-- Header -->
    <header class="p-4 border-b border-gray-700 bg-gray-850">
      <h2 class="text-xl font-bold">Group Chat</h2>
    </header>

    <!-- Messages -->
    <div id="chatList" class="flex-1 overflow-y-auto p-4 space-y-2"></div>

    <!-- Message Input -->
    <form id="messageForm" class="p-4 border-t border-gray-700 bg-gray-850">
      <input id="messageInput" type="text" placeholder="Type your message..." class="w-full p-3 rounded-lg bg-gray-800 text-white placeholder-gray-400 outline-none">
    </form>
  </div>

</body>
</html>
