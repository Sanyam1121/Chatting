<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="login">
  <div class="login-box">
    <h2>Join Chat</h2>
    <img id="pfp-preview" src="https://api.dicebear.com/7.x/thumbs/svg?seed=chat" />
    <input id="username" placeholder="Enter your name" />
    <input type="file" id="pfp-upload" accept="image/*" />
    <button onclick="joinChat()">Start Chat</button>
  </div>
</div>


  <div id="chat" class="hidden">
    <div id="chat-header"><img id="pfp-display"><span id="user-display"></span></div>
    <div id="messages"></div>
    <div id="typing"></div>
    <form id="form">
      <input id="input" autocomplete="off" placeholder="Type a message..." />
      <button>Send</button>
    </form>
  </div>

  <audio id="msg-sound" src="sound.mp3" preload="auto"></audio>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const login = document.getElementById("login");
    const chat = document.getElementById("chat");
    const form = document.getElementById("form");
    const input = document.getElementById("input");
    const messages = document.getElementById("messages");
    const typing = document.getElementById("typing");
    const sound = document.getElementById("msg-sound");

    let username = "", pfp = "";

    function joinChat() {
      username = document.getElementById("username").value;
      pfp = document.getElementById("pfp").value || "https://via.placeholder.com/40";
      if (!username) return;

      document.getElementById("user-display").textContent = username;
      document.getElementById("pfp-display").src = pfp;

      socket.emit("join", { username, pfp });
      login.classList.add("hidden");
      chat.classList.remove("hidden");
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      if (input.value) {
        addMessage("You", pfp, input.value, true);
        socket.emit("message", { username, pfp, message: input.value });
        input.value = "";
      }
    });

    input.addEventListener("input", () => {
      socket.emit("typing", `${username} is typing...`);
    });

    socket.on("message", data => {
      addMessage(data.username, data.pfp, data.message, false);
      typing.innerHTML = "";
      sound.play();
    });

    socket.on("typing", msg => {
      typing.innerHTML = msg;
      setTimeout(() => typing.innerHTML = "", 2000);
    });

    function addMessage(sender, pic, text, isSelf) {
      const msg = document.createElement("div");
      msg.className = `msg ${isSelf ? "self" : "other"}`;
      msg.innerHTML = `<img src="${pic}" /><div><strong>${sender}</strong><p>${text}</p></div>`;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }
  </script>
</body>
</html>
